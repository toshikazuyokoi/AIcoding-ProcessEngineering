# 設計実装整合性チェックリスト

## メタデータ
- **文書ID**: DICC-001
- **関連文書**: 
  - CLASS-001（クラス設計表）
  - IF-001（メソッドI/Fリスト）
  - 実装ファイル群
- **作成日**: YYYY-MM-DD
- **最終更新日**: YYYY-MM-DD
- **実施者**: [名前]
- **承認者**: [テクニカルリード名]

## 1. チェック概要

### 1.1 チェックの目的
| 目的 | 説明 | 重要度 |
|------|------|--------|
| 設計準拠性の確保 | 実装が設計書に従っているか確認 | 最高 |
| 早期問題発見 | 設計と実装の乖離を早期に検出 | 高 |
| 品質向上 | 一貫性のある実装による保守性向上 | 高 |
| ドキュメント最新化 | 実装に合わせた設計書の更新 | 中 |

### 1.2 チェック実施タイミング
````mermaid
graph LR
    A[実装開始] --> B[日次チェック]
    B --> C{整合性}
    C -->|OK| D[実装継続]
    C -->|NG| E[修正]
    E --> B
    D --> F[PR作成]
    F --> G[最終チェック]
    G --> H[マージ]
    
    style C fill:#ff9,stroke:#333,stroke-width:2px
    style G fill:#9ff,stroke:#333,stroke-width:2px
````

## 2. クラスレベル整合性チェック

### 2.1 クラス存在確認
| チェック項目 | 設計（CLASS-001） | 実装 | 結果 | 備考 |
|------------|-----------------|------|------|------|
| クラス名 | [設計上のクラス名] | [実装クラス名] | ✓/✗ | |
| パッケージ/名前空間 | [設計パッケージ] | [実装パッケージ] | ✓/✗ | |
| ファイルパス | [想定パス] | [実際のパス] | ✓/✗ | |
| アクセス修飾子 | [public/private] | [実装修飾子] | ✓/✗ | |

### 2.2 継承・実装関係
| 設計上の関係 | 実装確認 | 結果 | 不整合詳細 |
|------------|----------|------|-----------|
| 継承元クラス | [基底クラス名] | ✓/✗ | |
| 実装インターフェース | [I/F名リスト] | ✓/✗ | |
| 依存クラス | [依存クラスリスト] | ✓/✗ | |

### 2.3 クラス責任の一致
| 責任 | 設計記述 | 実装確認方法 | 判定 |
|------|----------|-------------|------|
| 単一責任の遵守 | [設計上の責任] | メソッド数、凝集度 | ✓/✗ |
| レイヤー責任 | [レイヤー定義] | 依存方向確認 | ✓/✗ |

## 3. メソッドレベル整合性チェック

### 3.1 メソッドシグネチャ照合
| メソッド名 | 設計（IF-001） | 実装 | 一致 | 相違点 |
|-----------|--------------|------|------|--------|
| [メソッド1] | `設計シグネチャ` | `実装シグネチャ` | ✓/✗ | |
| [メソッド2] | `設計シグネチャ` | `実装シグネチャ` | ✓/✗ | |

### 3.2 パラメータ詳細チェック
| メソッド | パラメータ | 設計型 | 実装型 | 必須/任意 | 一致 |
|----------|-----------|--------|--------|----------|------|
| method1 | param1 | string | string | 必須 | ✓ |
| method1 | param2 | number | number | 任意 | ✓ |
| method2 | param1 | User | UserDto | 必須 | ✗ |

### 3.3 戻り値チェック
| メソッド | 設計戻り値 | 実装戻り値 | 一致 | 影響分析 |
|----------|-----------|-----------|------|----------|
| method1 | Promise<User> | Promise<User> | ✓ | - |
| method2 | void | boolean | ✗ | 呼び出し元修正必要 |

## 4. データ型整合性チェック

### 4.1 エンティティ/DTO照合
| 型名 | 設計プロパティ数 | 実装プロパティ数 | 差分 | 詳細 |
|------|----------------|----------------|------|------|
| User | 10 | 12 | +2 | 追加: createdAt, updatedAt |
| Product | 8 | 8 | 0 | 完全一致 |

### 4.2 型定義詳細
| 型名.プロパティ | 設計型 | 実装型 | 必須/任意 | 一致 |
|---------------|--------|--------|----------|------|
| User.id | string | string | 必須 | ✓ |
| User.email | string | string | 必須 | ✓ |
| User.age | number | number | 任意 | ✓ |
| User.createdAt | - | Date | 必須 | ✗ |

## 5. 処理フロー整合性チェック

### 5.1 シーケンス照合
````mermaid
sequenceDiagram
    participant C as Client
    participant S as Service
    participant R as Repository
    participant D as Database
    
    Note over C,D: 設計シーケンス
    C->>S: createUser(data)
    S->>S: validateData(data)
    S->>R: save(user)
    R->>D: INSERT
    D-->>R: result
    R-->>S: savedUser
    S-->>C: response
    
    Note over C,D: 実装との差異
    C->>S: ✓ 一致
    S->>S: ✗ 追加: hashPassword()
    S->>R: ✓ 一致
    R->>D: ✓ 一致
````

### 5.2 処理ステップ比較
| ステップ | 設計 | 実装 | 差異 | 影響 |
|----------|------|------|------|------|
| 1 | データ受信 | データ受信 | なし | - |
| 2 | バリデーション | バリデーション | なし | - |
| 3 | - | パスワードハッシュ化 | 追加 | セキュリティ向上 |
| 4 | DB保存 | DB保存 | なし | - |
| 5 | レスポンス返却 | レスポンス返却 | なし | - |

## 6. 依存関係整合性チェック

### 6.1 インポート/依存性検証
| クラス | 設計上の依存 | 実装上の依存 | 差異 | 正当性 |
|--------|------------|------------|------|--------|
| UserService | UserRepository | UserRepository | なし | ✓ |
| UserService | - | PasswordHasher | 追加 | ✓ セキュリティ要件 |
| UserService | Logger | - | 削除 | ✗ ログ出力必要 |

### 6.2 循環依存チェック
| 依存パス | 検出結果 | 設計想定 | 対策 |
|----------|----------|----------|------|
| A→B→C→A | 検出 | 想定外 | インターフェース導入 |
| X→Y→X | なし | - | - |

## 7. 命名規則整合性チェック

### 7.1 命名規則準拠
| 要素 | 設計規則 | 実装例 | 準拠 | 修正案 |
|------|----------|--------|------|--------|
| クラス名 | PascalCase | userService | ✗ | UserService |
| メソッド名 | camelCase | GetUser | ✗ | getUser |
| 定数名 | UPPER_SNAKE | maxRetry | ✗ | MAX_RETRY |

### 7.2 意味的一貫性
| 設計用語 | 実装での表現 | 一貫性 | 推奨 |
|----------|------------|--------|------|
| 作成 | create | ✓ | - |
| 取得 | get/fetch | ✗ | 統一: get |
| 更新 | update/modify | ✗ | 統一: update |

## 8. 非機能要件との整合性

### 8.1 パフォーマンス要件
| 要件 | 設計考慮 | 実装確認 | 結果 |
|------|----------|----------|------|
| レスポンス<200ms | キャッシュ設計 | キャッシュ実装 | ✓ |
| 同時接続>100 | コネクションプール | プール未実装 | ✗ |

### 8.2 セキュリティ要件
| 要件 | 設計対策 | 実装状況 | 判定 |
|------|----------|----------|------|
| 認証必須 | JWT設計 | JWT実装 | ✓ |
| 暗号化 | HTTPS | HTTPS設定 | ✓ |
| SQLインジェクション対策 | パラメータ化 | 生クエリ使用 | ✗ |

## 9. 自動チェックツール結果

### 9.1 静的解析結果
```bash
# 実行コマンド
npm run check:design-consistency

# 結果サマリー
Total files checked: 45
Design matched: 38 (84%)
Design mismatched: 7 (16%)
  - Missing methods: 3
  - Type mismatches: 2
  - Extra implementations: 2
```

### 9.2 不整合詳細
| ファイル | 不整合種別 | 詳細 | 重要度 |
|----------|-----------|------|--------|
| user.service.ts | メソッド不足 | deleteUser未実装 | 高 |
| product.entity.ts | 型不一致 | price: number→string | 高 |
| auth.guard.ts | 余分な実装 | 設計にないメソッド | 低 |

## 10. 改善アクション

### 10.1 即時対応項目（Critical）
| 項目 | 内容 | 対応方法 | 期限 | 担当 |
|------|------|----------|------|------|
| SQLインジェクション | 生クエリ使用 | パラメータ化クエリに修正 | 即時 | [名前] |
| 必須メソッド未実装 | deleteUser | 実装追加 | 1日以内 | [名前] |

### 10.2 計画的対応項目（Important）
| 項目 | 内容 | 対応方法 | 期限 | 担当 |
|------|------|----------|------|------|
| 型不一致 | price型相違 | 設計or実装の修正 | 1週間 | [名前] |
| 命名規則違反 | 複数箇所 | リファクタリング | 2週間 | [名前] |

### 10.3 設計更新項目
| 更新対象 | 理由 | 更新内容 | 承認者 |
|----------|------|----------|--------|
| CLASS-001 | セキュリティ要件追加 | PasswordHasher依存追加 | [名前] |
| IF-001 | 実装最適化 | パラメータ型変更 | [名前] |

## 11. 整合性スコア

### 11.1 カテゴリ別スコア
````mermaid
radar
    title 設計実装整合性スコア
    "クラス構造": 85
    "メソッドI/F": 78
    "データ型": 92
    "処理フロー": 88
    "依存関係": 75
    "命名規則": 70
    "非機能要件": 83
````

### 11.2 総合評価
| 評価項目 | スコア | 判定基準 | 判定 |
|----------|--------|----------|------|
| 総合整合性スコア | 81.6% | >90%: 優良<br>80-90%: 良好<br><80%: 要改善 | 良好 |
| クリティカル項目 | 2件 | 0件で合格 | 要対応 |
| 改善推奨項目 | 5件 | - | 計画的対応 |

## 12. 完了チェックリスト

- [ ] 全クラスの存在確認を実施した
- [ ] 全メソッドのシグネチャを照合した
- [ ] データ型の整合性を確認した
- [ ] 処理フローの一致を検証した
- [ ] 依存関係を分析した
- [ ] 非機能要件との整合性を確認した
- [ ] 自動チェックツールを実行した
- [ ] 改善アクションを定義した
- [ ] 設計書の更新要否を判断した
- [ ] レビューを実施した

## 13. 承認

| 役割 | 氏名 | 確認日 | 署名 |
|------|------|--------|------|
| 実装担当者 | | | |
| テクニカルリード | | | |
| 品質保証担当 | | | |