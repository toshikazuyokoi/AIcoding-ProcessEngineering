# テストケース定義書

## メタデータ
| 項目 | 内容 |
|------|------|
| 文書ID | CASE-001 |
| 関連文書 | TARGET-001 (テスト対象一覧)<br>LOGIC-001 (処理ロジックテンプレート)<br>TYPE-001 (データ型仕様書)<br>REQ-001 (要求仕様書) |
| テストカテゴリ | [単体/結合/E2E] |
| 対象件数 | [テスト対象一覧での期待件数] |
| 実装件数 | [実際に定義したケース数] |
| カバレッジ率 | [実装件数/対象件数 × 100%] |
| 作成日 | YYYY-MM-DD |
| 最終更新日 | YYYY-MM-DD |
| 作成者 | [テスト設計者名] |
| 承認者 | [テストリード名] |
| バージョン | 1.0 |
| ステータス | ドラフト |

## 1. テストケースサマリ

### 1.1 カテゴリ別件数
| カテゴリ | 対象数 | ケース数 | カバレッジ | 備考 |
|----------|--------|----------|-----------|------|
| 単体テスト | [数] | [数] | [%] | [備考] |
| 結合テスト | [数] | [数] | [%] | [備考] |
| E2Eテスト | [数] | [数] | [%] | [備考] |
| **合計** | **[数]** | **[数]** | **[%]** | |

### 1.2 対象一覧との対応確認
| テスト対象ID | 対象名 | 期待ケース数 | 実装ケース数 | 状況 | 算出根拠 |
|-------------|--------|-------------|-------------|------|----------|
| TGT-001 | [対象名] | [数] | [数] | ✅/❌ | [仕様分析結果] |
| TGT-002 | [対象名] | [数] | [数] | ✅/❌ | [仕様分析結果] |
| TGT-003 | [対象名] | [数] | [数] | ✅/❌ | [仕様分析結果] |

### 1.3 仕様分析ベース展開サマリ
| 展開要素 | 分析結果 | 影響ケース数 |
|----------|----------|-------------|
| 入力パターン数 | [数]パターン | [数]ケース |
| ビジネスルール数 | [数]ルール | [数]ケース |
| エラー条件数 | [数]条件 | [数]ケース |
| データ状態数 | [数]状態 | [数]ケース |

## 2. テストケース定義（表形式）

### 2.1 単体テストケース
| ID | 対象 | 観点 | 入力 | 期待結果 | 優先度 | 実装状況 |
|----|------|------|------|----------|--------|----------|
| TC-001 | [メソッド名] | 正常系 | [入力値] | [期待値] | 高 | 未実装 |
| TC-002 | [メソッド名] | 異常系 | [入力値] | [例外] | 高 | 未実装 |
| TC-003 | [メソッド名] | 境界値 | [境界値] | [期待値] | 中 | 未実装 |
| TC-004 | [メソッド名] | セキュリティ | [不正入力] | [拒否] | 高 | 未実装 |
| TC-005 | [メソッド名] | パフォーマンス | [大量データ] | [制限時間内] | 中 | 未実装 |

### 2.2 結合テストケース
| ID | 対象API | 観点 | リクエスト | レスポンス | 前提条件 | 優先度 |
|----|---------|------|-----------|-----------|----------|--------|
| TC-101 | [API名] | 正常系 | [JSON] | [期待JSON] | [条件] | 高 |
| TC-102 | [API名] | 認証エラー | [JSON] | [401] | [条件] | 高 |
| TC-103 | [API名] | 権限エラー | [JSON] | [403] | [条件] | 高 |
| TC-104 | [API名] | バリデーションエラー | [不正JSON] | [400] | [条件] | 中 |
| TC-105 | [API名] | データ連携 | [JSON] | [期待JSON] | [DB状態] | 中 |

### 2.3 E2Eテストケース
| ID | シナリオ | 手順概要 | 期待結果 | データ | 優先度 |
|----|----------|----------|----------|--------|--------|
| TC-201 | [シナリオ名] | [手順] | [結果] | [テストデータ] | 高 |
| TC-202 | [エラーシナリオ] | [手順] | [エラー表示] | [テストデータ] | 高 |
| TC-203 | [複合シナリオ] | [手順] | [結果] | [テストデータ] | 中 |

## 3. 実装サンプル（最小限）

### 3.1 単体テスト実装例
```typescript
// TC-001の実装例
it('should handle valid input', () => {
  expect(target.method(validInput)).toBe(expectedOutput);
});

// TC-002の実装例
it('should throw error for invalid input', () => {
  expect(() => target.method(invalidInput)).toThrow(ValidationError);
});
```

### 3.2 結合テスト実装例
```typescript
// TC-101の実装例
it('should return 200 for valid request', async () => {
  const response = await request(app).post('/api/endpoint').send(data);
  expect(response.status).toBe(200);
});

// TC-102の実装例
it('should return 401 for unauthorized request', async () => {
  const response = await request(app).post('/api/endpoint').send(data);
  expect(response.status).toBe(401);
});
```

### 3.3 E2Eテスト実装例
```typescript
// TC-201の実装例
test('user can complete main scenario', async ({ page }) => {
  await page.goto('/');
  await page.fill('[data-testid=input]', 'test data');
  await page.click('[data-testid=submit]');
  await expect(page.locator('[data-testid=result]')).toBeVisible();
});
```

## 4. 品質ゲート5評価対象

### 4.1 定量的評価項目
| 評価項目 | 基準 | 実績 | 判定 |
|----------|------|------|------|
| **ケース数整合性** | テスト対象一覧との一致率 ≥ 95% | [%] | ✅/❌ |
| **カバレッジ完全性** | 全対象のカバレッジ = 100% | [%] | ✅/❌ |
| **トレーサビリティ** | 対象-ケース対応 = 100% | [%] | ✅/❌ |
| **実装可能性** | 実装可能ケース率 = 100% | [%] | ✅/❌ |

### 4.2 品質評価基準
- **合格基準**: 全評価項目が基準値以上
- **不合格時**: STEP 4.3へフィードバック、根本原因分析実施

### 4.3 評価プロセス
1. **定量的チェック**: テスト対象一覧の期待ケース数とテストケース定義書の実装ケース数を比較
2. **整合性率算出**: 実装数/期待数 × 100%
3. **カバレッジ確認**: 全対象がテストケースでカバーされているか確認
4. **トレーサビリティ確認**: 対象-ケース対応表の完全性確認
5. **実装可能性確認**: 全ケースが実装可能な形で定義されているか確認

### 4.4 不合格時の改善アクション
1. 不足ケースの特定と原因分析
2. 仕様再確認とケース追加
3. トレーサビリティマトリクス更新
4. 再評価実施

## 5. ファイル分割指示

### 5.1 分割基準
- **単体テスト**: `test-cases-unit.md`
- **結合テスト**: `test-cases-integration.md`
- **E2Eテスト**: `test-cases-e2e.md`
- **サマリ**: `test-cases-summary.md`

### 5.2 分割実施条件
- 各カテゴリのケース数が50件を超える場合
- ファイルサイズが500行を超える場合
- 管理上の利便性を考慮して分割が必要な場合

### 5.3 分割時のファイル構成例
```
test-cases-summary.md      # 全体サマリ・品質ゲート評価
test-cases-unit.md         # 単体テストケース詳細
test-cases-integration.md  # 結合テストケース詳細
test-cases-e2e.md         # E2Eテストケース詳細
```

## 6. トレーサビリティマトリクス

### 6.1 対象-ケース対応表
| テスト対象ID | 対象名 | 関連テストケース | カバレッジ |
|-------------|--------|-----------------|-----------|
| TGT-001 | [対象名] | TC-001, TC-002, TC-101 | 100% |
| TGT-002 | [対象名] | TC-003, TC-004, TC-102 | 100% |
| TGT-003 | [対象名] | TC-005, TC-201 | 100% |

### 6.2 要件-ケース対応表
| 要件ID | 要件名 | 関連テストケース | 検証状況 |
|--------|--------|-----------------|----------|
| REQ-001 | [要件名] | TC-001, TC-101, TC-201 | ✅ |
| REQ-002 | [要件名] | TC-002, TC-102 | ✅ |
| REQ-003 | [要件名] | TC-003, TC-203 | ✅ |

## 7. 完了確認チェックリスト
- [ ] テスト対象一覧との件数整合性が確認されている
- [ ] 全テストケースが表形式で効率的に定義されている
- [ ] 品質ゲート5評価項目が明確に定義されている
- [ ] 必要に応じてファイル分割が実施されている
- [ ] トレーサビリティマトリクスが完成している
- [ ] 実装サンプルが最小限で提供されている
- [ ] 仕様分析ベース展開が適切に実施されている
- [ ] カバレッジ率が95%以上達成されている
- [ ] 全評価項目が品質基準を満たしている
- [ ] 次工程（STEP 5: 開発計画）への引き継ぎ情報が整理されている
